<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #whiteBoard{
            position: fixed;
            top: 0;left: 0vw;width: 100vw;height: 100vh;
            z-index: 7000;
            background-color: white;
            transition: all 1s;
            opacity: 1;
            box-shadow: 0 0 10px gray;
        }
        body{
            width: 100vw;
            overflow-x: hidden;
        }
        #navigator{
            z-index: 999;
            position: fixed;
            top: 0;left: 0;
            backdrop-filter: blur(2rem);
            width: 100vw;
            height: 3rem;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
        }
        #navigator::before{
            z-index: 3;
            content: '';
            position: absolute;
            top: 0;right: 0;left: 0;bottom: 0;
            background-color: white;
            opacity: 0.7;
        }
        .nagivator_item{
            z-index: 4;
            line-height: 3rem;
            padding: 0 1rem;
            transition: all 0.3s;
            cursor: none;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            font-family: "等线";
            font-size: large;
        }
        .nagivator_item:hover{
            cursor: pointer;
            background: darkgray;
        }
        #main{
            display: flex;
            width: 80%;
            height: auto;
            position: relative;
            justify-content: space-around;
            margin: 0 auto;
            margin-top: 6rem;
        }
        #mainCont{
            width: 80%;
            margin: 0 10px;
            width: 90%;
        }
        #MainImages{
            width: 100%;
            height: 600px;
            margin: 0 auto;
            position: relative;
            border-radius: 10px;
            box-shadow: 0 0 20px gray;
            overflow-x: hidden;
        }
        #MainImages:hover{
            cursor: pointer;
        }
        .changePage{
            position: absolute;
            background: linear-gradient(to right, rgba(70,70,70,70),rgba(70,70,70,0));
            width: 20%;
            height: 100%;
            top: 0;
            transition: all 0.3s;
            line-height: 600px;
            font-size: 60px;
            font-family: "黑体";
            color: white;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
        }
        .changePage:hover{
            text-shadow: 0 0 10px white;
            font-size: 180px;
        }
        #c2{
            background: linear-gradient(to left, rgba(70,70,70,70),rgba(70,70,70,0));
        }
        #dots{
            position: absolute;
            left: 0;right: 0;
            bottom: 10px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4;
        }
        .dot{
            margin: 6px 6px;
            width: 10px;height: 10px;
            background-color: gray;
            border-radius: 50%;
            box-shadow: 0 0 10px gray;
            transition: all 0.3s;
        }
        #images{
            position: absolute;
            top:0;left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            transition: all 0.3s;
        }
        #images img{
            flex-shrink: 0;
            height: 100%;
            width: 100%;
        }
        .VSplit{
            width: 1px;
            height: 60%;
            background-color: gray;
        }
        #types{
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            font-size: medium;
            border-radius: 10px;
            box-shadow: 0 0 20px lightgray;
            margin-top: 20px;
            background-color: #e6f8f6;
            position: relative;
        }
        #types div{
            z-index: 2;
            padding: 0 10px;
            height: 40px;
            line-height: 40px;
            transition: all 0.3s;
            width: 32px;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }
        #types div:hover{
            cursor: pointer;
        }
        #typeBlock{
            transition: all 0.3s;
        }
        #goods1,
        #goods2{
            width: 70%;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(auto-fill,250px);
            grid-template-rows: repeat(auto-fill,300px);
            justify-items: center;
            align-items: center;
            background-color: #e6f8f6;
            border-radius: 10px;
            box-shadow: 0 0 20px lightgray;
            position: relative;
            flex-shrink: 0;
            padding: 20px;
            height: 1500px;
        }
        .item{
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        .item img{
            width: 200px;
            height: 150px;
            border-radius: 20px;
        }
        .item img:hover{
            cursor: pointer;
        }
        #goods{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            position: absolute;
            top: calc(6rem+660px);
            left: 0;
            overflow: visible;
            transition: all 0.3s;
            margin: 0 auto;
        }
        #typeBlock{
            width: 32px;
            z-index: 1;
            transition: all 0.3s;
            position: absolute;
            background-color: gray;
        }
        input{
            width: 30%;
            height: 30px;
            border: none;
            outline: none;
            border-radius: 5px;
            text-align: center;
            line-height: 30px;
        }
        #g1,#g2{
            z-index: 5;
            width: 100vw;display: flex;
            position: relative;
            justify-content: center;
            flex-shrink: 0;
            overflow: visible;
        }
        #g1{
            height: 1300px;
        }
        #recommand{
            position: fixed;
            z-index: 1200;
            bottom: 0;left: 0;right: 0;
            height: 120px;
            backdrop-filter: blur(2rem);
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            box-shadow: 0 0 10px gray;
        }
        #blackMask{
            content: '';
            position: absolute;
            z-index: 1198;
            bottom: 0;left: 0;right: 0;top: 0;
            background-color: black;
            opacity: 0.2;
        }
        #recommand h3{
            z-index: 1200;
            flex-shrink: 0;
        }
        marquee img{
            margin: 0 20px;
            width: 150px;
            height: 100px;
            border-radius: 10px;
        }
        marquee{
            z-index: 1198;
        }
    </style>
</head>
<body>
    <div id="recommand">
        <div id="blackMask"></div>
        <h3 style="margin: 0 20px;">为您推荐</h3>
        <marquee behavior="" direction="left">
            <img src="images/dt.jpg" alt="">
            <img src="images/cf.jpg" alt="">
            <img src="images/csb.jpg" alt="">
            <img src="images/sm.jpg" alt="">
            <img src="images/mtg.jpg" alt="">
            <img src="images/zcj.jpg" alt="">
            <img src="images/zpg.jpg" alt="">
        </marquee>
    </div>
    <div id="whiteBoard"></div>
    <div id="navigator">
        <div style="margin-left: 2rem;" class="nagivator_item" onclick="pageLeave('index.html')">首页</div>
        <div class="nagivator_item" id="pur">订购</div>
        <div class="nagivator_item" onclick="pageLeave('forum.html')">讨论</div>
        <div class="nagivator_item">关于</div>
        <div class="VSplit"></div>
        <div class="nagivator_item" id="login_name">未登录</div>
    </div>

    <div id="main">
        <div id="mainCont">
            <div id="MainImages" onmouseenter="hoverImages()" onmouseleave="leaveImages()">
                <div id="images">
                    <img src="images/big.jpg" alt="">
                    <img src="images/big2.jpg" alt="">
                    <img src="images/big3.jpg" alt="">
                </div>
                <div class="changePage" onclick="changeImage(-1)" id="c1" style="left: -20%;text-align: start;">&nbsp;&lt;</div>
                <div class="changePage" onclick="changeImage(1)" id="c2" style="left: 100%;text-align: end;">&gt;&nbsp;</div>
                <div id="dots">
                    <div class="dot" style="background-color: white;"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
            <div id="types">
                <div id="typeBlock"></div>
                <div id="type1" onclick="changeType(0)" style="margin-left: 40px;color: white;">茶点</div>
                <div id="type2" onclick="changeType(1)">饮品</div>
                <div id="addInventory" style="background-color: #46cdcf;justify-self: flex-end;width: auto;margin-left: 60px;">加入购物车</div>
            </div>
        </div>
    </div>
    <div id="goods">
        <div id="g1">
            <div id="goods1">
                
            </div>
        </div>
        
        <div id="g2">
            <div id="goods2">
                
            </div>
        </div>
    </div>

    <script src="makeinventory.js"></script>
    <script>
        function $(e){return document.getElementById(e)}
        function $c(e){return document.getElementsByClassName(e)}
    </script>
    <script>
        $("typeBlock").style.width = $("type1").clientWidth
        $("typeBlock").style.height = $("type1").clientHeight
        $("typeBlock").style.left = "40px"
        window.onload = (e)=>{
            $("whiteBoard").style.left = "100vw"
        }
        $("goods").style.left = "0"
        $("g2").style.display = "none"
        function changeType(e){
            if(e==0){
                $("typeBlock").style.width = 32
                $("typeBlock").style.height = $("type1").clientHeight
                $("typeBlock").style.left = "40px"
                $("type1").style.color = "white"
                $("type2").style.color = "black"
                $("goods").style.left = "0vw"
                $("g2").style.display = "none"

            }else{
                $("typeBlock").style.width = 32
                $("typeBlock").style.height = $("type2").clientHeight
                $("typeBlock").style.left = "92px"
                $("type1").style.color = "black"
                $("type2").style.color = "white"
                $("goods").style.left = "-100vw"
                $("g2").style.display = "flex"

            }
        }
        var c1 = $("c1")
        var c2 = $("c2")
        var dots = $c("dot")
        var imageIndex = 0
        var imageLength = $("images").children.length
        
        function hoverImages(){
            c1.style.left = "0%"
            c2.style.left = "80%"
        }
        function leaveImages(){
            c1.style.left = "-20%"
            c2.style.left = "100%"
        }
        function changeImage(e){
            if(e==1){
                imageIndex++
                if(imageIndex>=imageLength){ imageIndex = 0 }
                $("images").style.left = (-imageIndex * 100) + "%"
                updateDots()
                return
            }
            imageIndex--
            if(imageIndex<0){ imageIndex = imageLength-1 }
            $("images").style.left = (-imageIndex * 100) + "%"
            updateDots()
        }
        function updateDots(){
            for(var i = 0;i<imageLength;i++){
                if(i==imageIndex){
                    $("dots").children[i].style.backgroundColor = "white"
                    continue
                }
                $("dots").children[i].style.backgroundColor = "gray"
            }
        }
        //轮播
        setInterval(()=>{
            imageIndex++
            if(imageIndex>=imageLength){ imageIndex = 0 }
            $("images").style.left = (-imageIndex * 100) + "%"
            updateDots()
        },3000)
        function pageLeave(e){
            $("whiteBoard").style.left = "0vw"
            setTimeout(() => {
                window.location.href = e
            }, 1000);
        }
        $("pur").focus()
        var e2MapID = makePurchases($("goods1"),$("goods2"), pageLeave)
        var e2Keys = Array.from(e2MapID.keys())
        for(var l of e2MapID){
            bindEvent(l[0], "onclick", e2event, l[1][0])
            l[1][1].goodsID = l[1][0]
            bindEvent(l[1][1], "onchange", change1, l[1][0], )
        }
        //闭包绑定事件传递参数
        function bindEvent(dom, eventType, fun, args) {
            function handleEvent(){
                // console.log(args);
                fun.call(this,args)
            }
            dom[eventType] = handleEvent
        }
        function e2event(id){
            pageLeave('goodsDetail.html?goodsID='+id)
        }
        //购物车
        if(localStorage.getItem("inventory")==null){
            localStorage.setItem("inventory",JSON.stringify({inventory:[]}))
        }
        var inventory1 = JSON.parse(localStorage.getItem("inventory"))
        var inputs = document.getElementsByTagName("input")
        for(var i = 0;i < inventory1.inventory.length;i++){
            for(var j = 0;j<inputs.length;j++){
                if(inputs[j].goodsID == inventory1.inventory[i].id){
                    inputs[j].value = inventory1.inventory[i].count
                    break
                }
            }
        }
        function change1(id1){
            //修改商品
            if(this.value<0){
                this.value = 0
            }
            var index1 = findExist(id1)
            if(index1 == -1){
                inventory1.inventory.push({id: id1, count: this.value})
            }else{
                if(this.value <= 0){
                    inventory1.inventory.splice(index1)
                }else{
                    inventory1.inventory[index1].count = this.value
                }
            }
            localStorage.setItem("inventory", JSON.stringify(inventory1))
        }
        function findExist(id){
            for(var i = 0;i<inventory1.inventory.length;i++){
                if(inventory1.inventory[i].id == id){
                    return i
                }
            }
            return -1
        }
    </script>
    <script>
        var logout
        var purchaseInventory
        //登录相关
        function logoutF(){
            localStorage.removeItem("login_name")
            $("navigator").removeChild(logout)
            $("navigator").removeChild(purchaseInventory)
            $("login_name").innerHTML = "未登录"
            $("login_name").onclick = goToLogin
        }
        function goToLogin(){
            pageLeave("login.html?forward=purchase.html")
        }
        if (localStorage.getItem("login_name")==null){
            $("login_name").innerHTML = "未登录"
            $("login_name").onclick = goToLogin
        }else{
            $("login_name").innerHTML = localStorage.getItem("login_name")
            $("login_name").onclick = (e)=>{
                pageLeave("personalPage.html")
            }
            logout = document.createElement("div")
            logout.className = "nagivator_item"
            logout.innerHTML = "登出"
            logout.onclick = logoutF
            purchaseInventory = document.createElement("div")
            purchaseInventory.className = "nagivator_item"
            purchaseInventory.innerHTML = "购物车"
            purchaseInventory.onclick = (e)=>{
                pageLeave('purchaseInventory.html')
            }
            $("navigator").append(purchaseInventory)
            $("navigator").append(logout)
        }
    </script>
</body>
</html>